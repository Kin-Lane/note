<?php$route = '/notes/bytag/:tag/';$app->get($route, function ($tag)  use ($app){	$ReturnObject = array();	$tag = trim(mysql_real_escape_string($tag));	if(isset($params['query'])){ $query = trim(mysql_real_escape_string($params['query'])); } else { $query = '';}	if(isset($params['page'])){ $page = trim(mysql_real_escape_string($params['page'])); } else { $page = 0;}	if(isset($params['count'])){ $count = trim(mysql_real_escape_string($params['count'])); } else { $count = 250;}	if(isset($params['sort'])){ $sort = trim(mysql_real_escape_string($params['sort'])); } else { $sort = 'modified_date';}	if(isset($params['order'])){ $order = trim(mysql_real_escape_string($params['order'])); } else { $order = 'DESC';}	$Query = "SELECT DISTINCT n.note_id,n.title,n.details,n.post_date,n.modified_date FROM notes n";	$Query .= " JOIN note_tag_pivot npt ON n.note_id = npt.note_id";	$Query .= " JOIN tags t ON npt.tag_id = t.tag_id";	$Query .= " WHERE t.tag = '" . $tag . "'";	if($query!='')		{		$Query .= " AND n.title LIKE '%" . $query . "%' OR n.details LIKE '%" . $query . "%'";		}	$Query .= " ORDER BY n." . $sort . " " . $order . " LIMIT " . $page . "," . $count;	//echo $Query . "<br />";	$notesResult = mysql_query($Query) or die('Query failed: ' . mysql_error());	while ($notes = mysql_fetch_assoc($notesResult))		{		$note_id = $notes['note_id'];		$title = $notes['title'];		$details = $notes['details'];		$post_date = $notes['post_date'];		$modified_date = $notes['modified_date'];		// manipulation zone		$host = $_SERVER['HTTP_HOST'];		$note_id = prepareIdOut($note_id,$host);				$F = array();		$F['note_id'] = $note_id;		$F['title'] = $title;		$F['details'] = $details;		$F['post_date'] = $post_date;		$F['modified_date'] = $modified_date;		array_push($ReturnObject, $F);		}		$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($ReturnObject));	});?>